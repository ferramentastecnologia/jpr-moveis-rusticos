{
  "name": "Lead Capture > WhatsApp",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "hubspot-lead",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-node",
      "name": "Webhook Lead",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300],
      "webhookId": "hubspot-lead"
    },
    {
      "parameters": {
        "functionCode": "const body = $input.item.json.body;\n\nconst formatPhone = (phone) => {\n  return phone.replace(/\\D/g, '');\n};\n\nconst formatDate = () => {\n  const now = new Date();\n  return now.toLocaleString('pt-BR', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n};\n\nreturn {\n  json: {\n    nome: body.nome || 'N√£o informado',\n    email: body.email || 'N√£o informado',\n    telefone: formatPhone(body.telefone || ''),\n    cidade: body.cidade || 'N√£o informado',\n    estado: body.estado || 'N√£o informado',\n    veiculo: body.veiculo || 'N√£o informado',\n    valorFipe: body.valorFipe || 'N√£o informado',\n    dataHora: formatDate(),\n    whatsappMessage: `üéØ *Novo Lead Capturado!*\\n\\nüë§ *Nome:* ${body.nome || 'N√£o informado'}\\nüì± *Telefone:* ${body.telefone || 'N√£o informado'}\\nüìß *Email:* ${body.email || 'N√£o informado'}\\nüìç *Cidade:* ${body.cidade || 'N√£o informado'} - ${body.estado || 'N√£o informado'}\\nüöó *Ve√≠culo:* ${body.veiculo || 'N√£o informado'}\\nüí∞ *Valor FIPE:* ${body.valorFipe || 'N√£o informado'}\\n\\n‚è∞ *Recebido em:* ${formatDate()}\\n\\n‚úÖ _Entre em contato o quanto antes!_`\n  }\n};\n"
      },
      "id": "format-node",
      "name": "Formatar Dados",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:8080/message/sendText/INSTANCE_NAME",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "SUA_API_KEY_AQUI"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=GROUP_ID_AQUI"
            },
            {
              "name": "text",
              "value": "={{$json.whatsappMessage}}"
            }
          ]
        },
        "options": {}
      },
      "id": "whatsapp-node",
      "name": "Enviar WhatsApp",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [650, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\"success\": true, \"message\": \"Lead recebido com sucesso!\"}",
        "options": {}
      },
      "id": "response-node",
      "name": "Responder",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [850, 300]
    }
  ],
  "connections": {
    "Webhook Lead": {
      "main": [
        [
          {
            "node": "Formatar Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Dados": {
      "main": [
        [
          {
            "node": "Enviar WhatsApp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar WhatsApp": {
      "main": [
        [
          {
            "node": "Responder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "id": "lead-capture-whatsapp"
}
